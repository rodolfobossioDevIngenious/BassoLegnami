import{r as e,c as t,h as s,H as i}from"./p-ee0b9025.js";import{i as a}from"./p-273970f1.js";import{c as l,a as n}from"./p-c74b54ba.js";import{E as o}from"./p-d88cb309.js";import{e as r}from"./p-93cac3a6.js";import{a as c}from"./p-ccd51ea4.js";import{f as h}from"./p-34c33cf9.js";import"./p-971980b1.js";import"./p-82db2ff5.js";import"./p-949334ec.js";import{m as d}from"./p-1b40b0d1.js";import{a as u}from"./p-e77aabd2.js";import{T as f}from"./p-37df3757.js";import{T as w}from"./p-821a7518.js";import{L as y,W as p}from"./p-79414d9f.js";import{l as m}from"./p-6137089a.js";import{c as v}from"./p-a3b5bd35.js";import"./p-1b1f9628.js";import"./p-83f217d4.js";import"./p-e0c1fede.js";import"./p-f1ec68ec.js";import"./p-80de33dc.js";const g={en:{default:{Publishing:"Publishing...",Published:"Published",ActivityContextMenu:{Edit:"Edit",Delete:"Delete",DeleteSelected:"Delete Selected"},ConnectionContextMenu:{Paste:"Paste"},Restart:"Restart",DeleteConfirmationModel:{Title:"Delete Workflow Definition",Message:"Are you sure you wish to permanently delete this workflow, including all of its workflow instances?"}}},"zh-CN":{default:{Publishing:"发布中...",Published:"已发布",ActivityContextMenu:{Edit:"编辑",Delete:"删除",DeleteSelected:"删除所选"},ConnectionContextMenu:{Paste:"粘贴"},Restart:"重启",DeleteConfirmationModel:{Title:"删除工作流程定义",Message:"你确定要永久删除这个工作流程，包括它的所有工作流程实例？"}}},"nl-NL":{default:{Publishing:"Publiceren...",Published:"Gepubliceerd",ActivityContextMenu:{Edit:"Bewerken",Delete:"Verwijderen",DeleteSelected:"Verwijder Geselecteerde"},ConnectionContextMenu:{Paste:"Plakken"},Restart:"Herstarten",DeleteConfirmationModel:{Title:"Verwijder Workflow Definitie",Message:"Weet je zeker dat je deze workflow permanent wilt verwijderen, inclusief alle bijbehorende workflow instanties?"}}},"fa-IR":{default:{Publishing:"در حال انتشار...",Published:"منتشر شده",ActivityContextMenu:{Edit:"ویرایش",Delete:"حذف",DeleteSelected:"حذف موارد انتخاب شده"},ConnectionContextMenu:{Paste:"Paste"},Restart:"راه اندازی مجدد",DeleteConfirmationModel:{Title:"حذف تعریف فرآیند",Message:"آیا از حذف این فرآیند و همه جریانهای آن اطمینان دارید?"}}},"de-DE":{default:{Publishing:"Am veröffentlichen",Published:"Veröffentlicht",ActivityContextMenu:{Edit:"Bearbeiten",Delete:"Entfernen",DeleteSelected:"Ausgewählte entfernen"},ConnectionContextMenu:{Paste:"Einfügen"},Restart:"Neustarten",DeleteConfirmationModel:{Title:"Ablaufdefinition entfernen",Message:"Sind Sie sicher, dass sie die Definition und die dazugehörigen Instanzen unwiderruflich löschen wollen?"}}}};let x=class{constructor(i){e(this,i),this.workflowSaved=t(this,"workflowSaved",7),this.serverFeatures=[],this.workflowTestActivityMessages=[],this.layoutDirection=y.TopBottom,this.activityContextMenuState={shown:!1,x:0,y:0,activity:null,selectedActivities:{}},this.activityContextMenuTestState={shown:!1,x:0,y:0,activity:null},this.configureComponentCustomButtonContext=null,this.t=e=>this.i18next.t(e),this.onTestActivityMessageReceived=async e=>{const t=e;t?(this.workflowInstanceId=t.workflowInstanceId,this.workflowTestActivityMessages=this.workflowTestActivityMessages.filter((e=>e.activityId!==t.activityId)),this.workflowTestActivityMessages=[...this.workflowTestActivityMessages,t]):(this.workflowTestActivityMessages=[],this.workflowInstanceId=null),this.render()},this.onUpdateWorkflowSettings=async e=>{this.updateWorkflowDefinition(e),await this.saveWorkflowInternal(this.workflowModel)},this.onFlyoutPanelTabSelected=async e=>{const t=e;"general"===t&&(this.workflowDesignerMode=p.Edit),"test"===t&&(this.workflowDesignerMode=p.Test),this.render()},this.onUpdateActivity=e=>{const t=this.workflowTestActivityMessages.find((t=>t.activityId===e.activityId));t&&(t.status=l.Modified,this.clearSubsequentWorkflowTestMessages(e.activityId))},this.renderActivityStatsButton=e=>{const t=this.workflowTestActivityMessages.find((t=>t.activityId==e.activityId));if(null==t)return"";let s;switch(t.status){case l.Done:default:s='<svg class="elsa-h-8 elsa-w-8 elsa-text-green-500"  fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                </svg>';break;case l.Waiting:s='<svg version="1.1" class="svg-loader" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 80 80" xml:space="preserve">\n                  <path id="spinner" fill="#7eb0de" d="M40,72C22.4,72,8,57.6,8,40C8,22.4,\n                  22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2\n                  s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,\n                  28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.75s" repeatCount="indefinite" />\n                  </path>\n                  </path>\n              </svg>';break;case l.Failed:s='<svg class="elsa-h-8 elsa-w-8 elsa-text-red-500"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <circle cx="12" cy="12" r="10" />\n                  <line x1="15" y1="9" x2="9" y2="15" />\n                  <line x1="9" y1="9" x2="15" y2="15" />\n                </svg>';break;case l.Modified:s='<svg class="h-6 w-6 elsa-text-yellow-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <line x1="12" y1="16" x2="12" y2="12"></line>\n                    <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                </svg>'}return`<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              ${s}\n            </button>\n          </div>`},this.renderTestActivityMenu=()=>{const e=this.workflowTestActivityMessages.find((e=>e.activityId==this.selectedActivityId)),t=()=>{var t,i;if(null!=e&&e&&e.error)return s("div",{class:"elsa-ml-4"},s("elsa-workflow-fault-information",{workflowFault:null===(t=this.workflowInstance)||void 0===t?void 0:t.faults.find((e=>e.faultedActivityId==this.selectedActivityId)),faultedAt:null===(i=this.workflowInstance)||void 0===i?void 0:i.faultedAt}))},i=()=>{if(!e.error)return s("div",{class:"elsa-ml-4"},s("elsa-workflow-performance-information",{activityStats:this.activityStats}))},o=()=>{if(this.canBeRestartedFromCurrentActivity())return s("button",{type:"button",onClick:()=>this.onRestartActivityButtonClick(),class:"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-red-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-red-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},this.t("Restart"))},n=()=>{if(null!=this.configureComponentCustomButtonContext.data)return s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("button",{type:"button",onClick:()=>this.onComponentCustomButtonClick(e),class:"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},this.configureComponentCustomButtonContext.data.label))};return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuTestState.shown?"":"hidden")+" elsa-absolute elsa-z-10 elsa-mt-3 elsa-px-2 elsa-w-screen elsa-max-w-xl sm:elsa-px-0",style:{left:`${this.activityContextMenuTestState.x+64}px`,top:this.activityContextMenuTestState.y-256+"px"},ref:e=>this.componentCustomButton=e},s("div",{class:"elsa-rounded-lg elsa-shadow-lg elsa-ring-1 elsa-ring-black elsa-ring-opacity-5 elsa-overflow-x-hidden elsa-overflow-y-auto",style:{"max-height":"700px"}},e?(()=>{var a,l;const r=this.t;if(null==e||!e)return;this.configureComponentCustomButton(e);const c={},d={State:!0,Input:null,Outcomes:!0,Exception:!0};for(const t in e.data){if(!e.data.hasOwnProperty(t))continue;if(d[t])continue;const s=e.data[t];if(!s&&0!=s)continue;let i=null;i="string"==typeof s?s:"object"==typeof s?JSON.stringify(s,null,1):void 0===s?null:s.toString(),c[t]=i}const h=!!(null===(l=null===(a=e.data)||void 0===a?void 0:a.Input)||void 0===l?void 0:l.Body);return s("div",{class:"elsa-relative elsa-grid elsa-gap-6 elsa-bg-white px-5 elsa-py-6 sm:elsa-gap-8 sm:elsa-p-8"},s("div",{class:"elsa-flex elsa-flex-row elsa-justify-between"},s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},r("Status")),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},e.status)),s("div",null,o())),v.map(c,((e,t)=>s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},t),s("pre",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500 elsa-overflow-x-auto",style:{"max-width":"30rem"}},e)))),h?n():void 0,t(),i())})():s("div",{class:"elsa-p-6 elsa-bg-white"},"Loading...")))},this.showHelpModal=async()=>{await this.helpDialog.show()},this.renderDesignerPanel=()=>{if(0!=h.getUIFeatureList().length)return[s("elsa-tab-header",{tab:"designer",slot:"header"},"Designer"),s("elsa-tab-content",{tab:"designer",slot:"content"},s("elsa-designer-panel",{onFeatureChanged:this.handleFeatureChange,onFeatureStatusChanged:this.handleFeatureStatusChange}))]},this.renderVersionHistoryPanel=e=>[s("elsa-tab-header",{tab:"versionHistory",slot:"header"},"Version History"),s("elsa-tab-content",{tab:"versionHistory",slot:"content"},s("elsa-version-history-panel",{workflowDefinition:e,onVersionSelected:e=>this.onVersionSelected(e),onDeleteVersionClicked:e=>this.onDeleteVersionClicked(e),onRevertVersionClicked:e=>this.onRevertVersionClicked(e)}))],this.handleFeatureChange=e=>{const t=e.detail;if(t===h.supportedFeatures.workflowLayout){const e=h.getFeatureConfig(t);this.layoutDirection=e.value}},this.handleFeatureStatusChange=e=>{const t=e.detail;if(t===h.supportedFeatures.workflowLayout){const e=h.getFeatureConfig(t);this.layoutDirection=e.enabled?e.value:y.TopBottom}},this.onVersionSelected=async e=>{const t=await c(this.serverUrl),s=e.detail,i=await t.workflowDefinitionsApi.getByDefinitionAndVersion(s.definitionId,{version:s.version});this.updateWorkflowDefinition(i)},this.onDeleteVersionClicked=async e=>{const t=await c(this.serverUrl),s=e.detail;await t.workflowDefinitionsApi.delete(s.definitionId,{version:s.version}),this.updateWorkflowDefinition(Object.assign({},this.workflowDefinition))},this.onRevertVersionClicked=async e=>{const t=await c(this.serverUrl),s=e.detail,i=await t.workflowDefinitionsApi.revert(s.definitionId,s.version);this.updateWorkflowDefinition(i)}}async getServerUrl(){return this.serverUrl}async getWorkflowDefinitionId(){return this.workflowDefinition.definitionId}async exportWorkflow(){const e=await c(this.serverUrl),t=this.workflowDefinition,s={version:t.version},i=await e.workflowDefinitionsApi.export(t.definitionId,s);var o;o={contentType:"application/json",fileName:i.fileName},function(e,t){const s=document.createElement("a");s.href=e,s.download=null!=t.fileName?t.fileName:"",s.click(),s.remove()}(window.URL.createObjectURL(i.data),o)}async importWorkflow(e){const t=await c(this.serverUrl);this.importing=!0,this.imported=!1,this.networkError=null;try{const s=await t.workflowDefinitionsApi.import(this.workflowDefinition.definitionId,e);this.workflowDefinition=s,this.workflowModel=this.mapWorkflowModel(s),this.updateUrl(s.definitionId),this.importing=!1,this.imported=!0,setTimeout((()=>this.imported=!1),500),await r.emit(o.WorkflowImported,this,this.workflowModel)}catch(e){console.error(e),this.importing=!1,this.imported=!1,this.networkError=e.message,setTimeout((()=>this.networkError=null),1e4)}}async workflowDefinitionIdChangedHandler(e){const t=e;let s=x.createWorkflowDefinition();s.definitionId=t;const i=await c(this.serverUrl);if(t&&t.length>0)try{s=await i.workflowDefinitionsApi.getByDefinitionAndVersion(t,{isLatest:!0})}catch(e){console.warn("The specified workflow definition does not exist. Creating a new one.")}this.updateWorkflowDefinition(s)}async serverUrlChangedHandler(e){e&&e.length>0&&(await this.loadActivityDescriptors(),await this.loadWorkflowStorageDescriptors())}async monacoLibPathChangedHandler(e){u.monacoLibPath=e}async workflowChangedHandler(e){const t=e.detail;await this.saveWorkflowInternal(t)}onWindowClicked(e){const t=e.target;this.componentCustomButton.contains(t)||this.handleContextMenuTestChange(0,0,!1,null),this.activityContextMenu.contains(t)||this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null,selectedActivities:{}})}async componentWillLoad(){this.i18next=await m(this.culture,g),this.workflowDesignerMode=p.Edit;const e=h.getFeatureConfig(h.supportedFeatures.workflowLayout);e&&e.enabled&&(this.layoutDirection=e.value),await this.serverUrlChangedHandler(this.serverUrl),await this.workflowDefinitionIdChangedHandler(this.workflowDefinitionId),await this.monacoLibPathChangedHandler(this.monacoLibPath)}async componentDidLoad(){this.designer||(this.designer=this.el.querySelector(u.useX6Graphs?"x6-designer":"elsa-designer-tree"),this.designer.model=this.workflowModel)}componentDidRender(){var e;if(this.el&&this.componentCustomButton){let t=this.activityContextMenuTestState.x+64,s=this.activityContextMenuTestState.y-256;const i=null===(e=this.el)||void 0===e?void 0:e.getBoundingClientRect(),o=this.componentCustomButton.getBoundingClientRect(),n=null==o?void 0:o.width,a=null==o?void 0:o.height;t=Math.min(i.width,t+n+32)-n-32,s=Math.min(i.height,s+a)-a-32,s=Math.max(0,s),this.componentCustomButton.style.left=`${t}px`,this.componentCustomButton.style.top=`${s}px`}}connectedCallback(){r.on(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings),r.on(o.FlyoutPanelTabSelected,this.onFlyoutPanelTabSelected),r.on(o.TestActivityMessageReceived,this.onTestActivityMessageReceived),r.on(o.UpdateActivity,this.onUpdateActivity)}disconnectedCallback(){r.detach(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings),r.detach(o.FlyoutPanelTabSelected,this.onFlyoutPanelTabSelected),r.detach(o.TestActivityMessageReceived,this.onTestActivityMessageReceived),r.detach(o.UpdateActivity,this.onUpdateActivity)}async configureComponentCustomButton(e){this.configureComponentCustomButtonContext={component:"elsa-workflow-definition-editor-screen",activityType:e.activityType,prop:null,data:null},await r.emit(o.ComponentLoadingCustomButton,this,this.configureComponentCustomButtonContext)}async loadActivityDescriptors(){const e=await c(this.serverUrl);u.activityDescriptors=await e.activitiesApi.list()}async loadWorkflowStorageDescriptors(){const e=await c(this.serverUrl);u.workflowStorageDescriptors=await e.workflowStorageProvidersApi.list()}async tryUpdateActivityInformation(e){if(!this.workflowInstanceId)return this.activityStats=null,void(this.workflowInstance=null);const t=await c(this.serverUrl);this.activityStats=await t.activityStatsApi.get(this.workflowInstanceId,e),this.workflowInstance&&this.workflowInstance.id===this.workflowInstanceId||(this.workflowInstance=await t.workflowInstancesApi.get(this.workflowInstanceId))}updateWorkflowDefinition(e){this.workflowDefinition=e,this.workflowModel=this.mapWorkflowModel(e)}async publishWorkflow(){this.publishing=!0,await this.saveWorkflow(!0),this.publishing=!1,await r.emit(o.WorkflowPublished,this,this.workflowDefinition)}async unpublishWorkflow(){await this.unpublishWorkflowInternal(),await r.emit(o.WorkflowRetracted,this,this.workflowDefinition)}async revertWorkflow(){await this.revertWorkflowInternal()}async saveWorkflow(e){await this.saveWorkflowInternal(null,e)}async saveWorkflowInternal(e,t){if(!this.serverUrl||0==this.serverUrl.length)return;e=e||this.workflowModel;const s=await c(this.serverUrl);let i=this.workflowDefinition;const o=void 0===i.definitionId&&void 0===this.workflowDefinitionId,n={workflowDefinitionId:i.definitionId||this.workflowDefinitionId,contextOptions:i.contextOptions,deleteCompletedInstances:i.deleteCompletedInstances,description:i.description,displayName:i.displayName,isSingleton:i.isSingleton,name:i.name,tag:i.tag,channel:i.channel,persistenceBehavior:i.persistenceBehavior,publish:t||!1,variables:i.variables,activities:e.activities.map((e=>({activityId:e.activityId,type:e.type,name:e.name,displayName:e.displayName,description:e.description,x:e.x,y:e.y,persistWorkflow:e.persistWorkflow,loadWorkflowContext:e.loadWorkflowContext,saveWorkflowContext:e.saveWorkflowContext,properties:e.properties,propertyStorageProviders:e.propertyStorageProviders,category:""}))),connections:e.connections.map((e=>({sourceActivityId:e.sourceId,targetActivityId:e.targetId,outcome:e.outcome})))};this.saving=!t,this.publishing=t;try{console.debug("Saving workflow..."),i=await s.workflowDefinitionsApi.save(n),this.workflowDefinition=i,this.workflowModel=this.mapWorkflowModel(i),this.saving=!1,this.saved=!t,this.publishing=!1,setTimeout((()=>this.saved=!1),500),this.workflowSaved.emit(i),o&&this.updateUrl(i.definitionId)}catch(e){console.error(e),this.saving=!1,this.saved=!1,this.networkError=e.message,setTimeout((()=>this.networkError=null),1e4)}}async unpublishWorkflowInternal(){const e=await c(this.serverUrl),t=this.workflowDefinition.definitionId;this.unPublishing=!0;try{this.workflowDefinition=await e.workflowDefinitionsApi.retract(t),this.unPublishing=!1,this.unPublished=!0,setTimeout((()=>this.unPublished=!1),500)}catch(e){console.error(e),this.unPublishing=!1,this.unPublished=!1,this.networkError=e.message,setTimeout((()=>this.networkError=null),2e3)}}async revertWorkflowInternal(){const e=await c(this.serverUrl),t=this.workflowDefinition.definitionId,s=this.workflowDefinition.version;this.reverting=!0;try{this.workflowDefinition=await e.workflowDefinitionsApi.revert(t,s),this.reverting=!1,this.reverted=!0,setTimeout((()=>this.reverted=!1),500)}catch(e){console.error(e),this.reverting=!1,this.reverted=!1,this.networkError=e.message,setTimeout((()=>this.networkError=null),2e3)}}updateUrl(e){this.history&&this.history.push(`${this.basePath}/workflow-definitions/${e}`,{})}mapWorkflowModel(e){return{activities:e.activities.map(this.mapActivityModel),connections:e.connections.map(this.mapConnectionModel),persistenceBehavior:e.persistenceBehavior}}mapActivityModel(e){const t=u.activityDescriptors.find((t=>t.type==e.type));return{activityId:e.activityId,description:e.description,displayName:e.displayName,x:e.x,y:e.y,name:e.name,type:e.type,properties:e.properties,outcomes:[...t?t.outcomes:["Done"]],persistWorkflow:e.persistWorkflow,saveWorkflowContext:e.saveWorkflowContext,loadWorkflowContext:e.loadWorkflowContext,propertyStorageProviders:e.propertyStorageProviders}}mapConnectionModel(e){return{sourceId:e.sourceActivityId,targetId:e.targetActivityId,outcome:e.outcome}}async handleContextMenuChange(e){this.activityContextMenuState=e}handleContextMenuTestChange(e,t,s,i){this.activityContextMenuTestState={shown:s,x:e,y:t,activity:i}}async onShowWorkflowSettingsClick(){await r.emit(o.ShowWorkflowSettings)}async onDeleteClicked(){const e=this.t;if(!await this.confirmDialog.show(e("DeleteConfirmationModel.Title"),e("DeleteConfirmationModel.Message")))return;const t=await c(this.serverUrl);await t.workflowDefinitionsApi.delete(this.workflowDefinition.definitionId,{allVersions:!0}),this.history.push(`${this.basePath}/workflow-definitions`,{})}async onPublishClicked(){await this.publishWorkflow()}async onUnPublishClicked(){await this.unpublishWorkflow()}async onRevertClicked(){await this.revertWorkflow()}async onExportClicked(){await this.exportWorkflow()}async onImportClicked(e){await this.importWorkflow(e)}async onDeleteActivityClick(e){e.preventDefault();const{activity:t,selectedActivities:s}=this.activityContextMenuState;s[t.activityId]?await this.designer.removeSelectedActivities():await this.designer.removeActivity(t),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null,selectedActivities:{}}),await r.emit(o.HideModalDialog)}async onEditActivityClick(e){e.preventDefault(),await this.designer.showActivityEditor(this.activityContextMenuState.activity,!0),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null})}async onActivityContextMenuButtonClicked(e){this.activityContextMenuState=e.detail}async onActivityContextMenuButtonTestClicked(e){this.activityContextMenuTestState=e.detail,this.selectedActivityId=e.detail.activity.activityId,e.detail.shown&&await this.tryUpdateActivityInformation(this.selectedActivityId)}async onActivitySelected(e){this.selectedActivityId=e.detail.activityId}async onActivityDeselected(e){this.selectedActivityId==e.detail.activityId&&(this.selectedActivityId=null)}async onRestartActivityButtonClick(){await r.emit(o.WorkflowRestarted,this,this.selectedActivityId),this.handleContextMenuTestChange(0,0,!1,null)}clearSubsequentWorkflowTestMessages(e){var t;const s=null===(t=this.workflowDefinition.connections.find((t=>t.sourceActivityId===e)))||void 0===t?void 0:t.targetActivityId;s&&(this.workflowTestActivityMessages=this.workflowTestActivityMessages.filter((e=>e.activityId!==s||e.status===l.Failed)),this.clearSubsequentWorkflowTestMessages(s))}renderMonacoEditorDialog(){return s("elsa-modal-dialog",{ref:e=>{d.monacoEditorDialog=e}},s("div",{slot:"content",class:"elsa-py-8 elsa-px-4"},s("elsa-monaco",{value:"",language:"javascript","editor-height":"400px","single-line":!1,onValueChanged:e=>{d.currentValue=e.detail.value},ref:e=>d.monacoEditor=e})),s("div",{slot:"buttons"},s("div",{class:"elsa-bg-gray-50 elsa-px-4 elsa-py-3 sm:elsa-px-6 sm:elsa-flex sm:elsa-flex-row-reverse"},s("button",{type:"button",onClick:()=>{d.save(),d.monacoEditorDialog.hide()},class:"elsa-ml-3 elsa-inline-flex elsa-justify-center elsa-py-2 elsa-px-4 elsa-border elsa-border-transparent elsa-shadow-sm elsa-text-sm elsa-font-medium elsa-rounded-md elsa-text-white elsa-bg-blue-600 hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},"Save"),s("button",{type:"button",onClick:()=>{d.monacoEditorDialog.hide()},class:"elsa-mt-3 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-gray-300 elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-white elsa-text-base elsa-font-medium elsa-text-gray-700 hover:elsa-bg-gray-50 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 sm:elsa-mt-0 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},"Cancel"))))}render(){return s(i,{class:"elsa-flex elsa-flex-col elsa-w-full",ref:e=>this.el=e},s(f.Provider,{state:{serverUrl:this.serverUrl,workflowDefinitionId:this.workflowDefinition.definitionId,serverFeatures:this.serverFeatures}},this.renderCanvas(),this.renderActivityPicker(),this.renderActivityEditor(),this.renderMonacoEditorDialog()))}renderCanvas(){return s("div",{class:"elsa-flex-1 elsa-flex elsa-relative"},!u.useX6Graphs&&s("elsa-designer-tree",{model:this.workflowModel,mode:this.workflowDesignerMode,layoutDirection:this.layoutDirection,activityContextMenuButton:this.workflowDesignerMode==p.Edit?()=>'<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              <svg class="elsa-h-6 elsa-w-6 elsa-text-gray-400" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"\n                   stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n                <path stroke="none" d="M0 0h24v24H0z"/>\n                <circle cx="5" cy="12" r="1"/>\n                <circle cx="12" cy="12" r="1"/>\n                <circle cx="19" cy="12" r="1"/>\n              </svg>\n            </button>\n          </div>':this.renderActivityStatsButton,onActivityContextMenuButtonClicked:e=>this.onActivityContextMenuButtonClicked(e),onActivityContextMenuButtonTestClicked:e=>this.onActivityContextMenuButtonTestClicked(e),activityContextMenu:this.workflowDesignerMode==p.Edit?this.activityContextMenuState:this.activityContextMenuTestState,enableMultipleConnectionsFromSingleSource:!1,selectedActivityIds:[this.selectedActivityId],onActivitySelected:e=>this.onActivitySelected(e),onActivityDeselected:e=>this.onActivityDeselected(e),class:"elsa-flex-1",ref:e=>this.designer=e}),u.useX6Graphs&&s("x6-designer",{model:this.workflowModel,mode:this.workflowDesignerMode,layoutDirection:this.layoutDirection,activityContextMenuButton:this.workflowDesignerMode==p.Edit?()=>"":this.renderActivityStatsButton,onActivityContextMenuButtonClicked:e=>this.onActivityContextMenuButtonClicked(e),onActivityContextMenuButtonTestClicked:e=>this.onActivityContextMenuButtonTestClicked(e),activityContextMenu:this.workflowDesignerMode==p.Edit?this.activityContextMenuState:this.activityContextMenuTestState,enableMultipleConnectionsFromSingleSource:!1,selectedActivityIds:[this.selectedActivityId],onActivitySelected:e=>this.onActivitySelected(e),onActivityDeselected:e=>this.onActivityDeselected(e),class:"elsa-workflow-wrapper",ref:e=>this.designer=e}),this.renderWorkflowSettingsButton(),this.renderWorkflowHelpButton(),this.renderWorkflowPanel(),this.renderActivityContextMenu(),s("elsa-workflow-settings-modal",{workflowDefinition:this.workflowDefinition}),s("elsa-workflow-definition-editor-notifications",null),s("div",{class:"elsa-fixed elsa-bottom-10 elsa-right-12"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-4"},this.renderSavingIndicator(),this.renderNetworkError(),this.renderPublishButton())),this.renderTestActivityMenu(),s("elsa-confirm-dialog",{ref:e=>this.confirmDialog=e,culture:this.culture}))}async onComponentCustomButtonClick(e){const t=Object.assign({},this.workflowModel).activities.find((t=>t.activityId==e.activityId)),s={component:"elsa-workflow-definition-editor-screen",activityType:e.activityType,prop:null,params:[t,e.data.Input]};await r.emit(o.ComponentCustomButtonClick,this,s)}canBeRestartedFromCurrentActivity(){var e;if(!this.selectedActivityId)return!1;if(this.workflowDesignerMode!==p.Test)return!1;if(this.workflowTestActivityMessages.some((e=>e.activityId===this.selectedActivityId)))return!0;const t=null===(e=this.workflowDefinition.connections.find((e=>e.targetActivityId===this.selectedActivityId)))||void 0===e?void 0:e.sourceActivityId;return t&&this.workflowTestActivityMessages.some((e=>e.activityId===t&&e.status!==l.Failed))}renderActivityContextMenu(){var e;const t=this.t,i=Object.keys(null!==(e=this.activityContextMenuState.selectedActivities)&&void 0!==e?e:{}),{activity:o}=this.activityContextMenuState;return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuState.shown?"":"hidden")+" context-menu elsa-z-20 elsa-mx-3 elsa-w-48 elsa-mt-1 elsa-rounded-md elsa-shadow-lg elsa-fixed",style:{left:`${this.activityContextMenuState.x}px`,top:`${this.activityContextMenuState.y}px`},ref:e=>this.activityContextMenu=e},s("div",{class:"elsa-rounded-md elsa-bg-white elsa-shadow-xs",role:"menu","aria-orientation":"vertical","aria-labelledby":"pinned-project-options-menu-0"},s("div",{class:"elsa-py-1"},s("a",{onClick:e=>this.onEditActivityClick(e),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},t("ActivityContextMenu.Edit"))),s("div",{class:"elsa-border-t elsa-border-gray-100"}),s("div",{class:"elsa-py-1"},s("a",{onClick:e=>this.onDeleteActivityClick(e),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},i.length>1&&-1!==i.indexOf(o.activityId)?t("ActivityContextMenu.DeleteSelected"):t("ActivityContextMenu.Delete")))))}renderActivityPicker(){return s("elsa-activity-picker-modal",null)}renderActivityEditor(){return s("elsa-activity-editor-modal",{culture:this.culture})}renderWorkflowSettingsButton(){return s("button",{onClick:()=>this.onShowWorkflowSettingsClick(),type:"button",class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-12 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",class:"elsa-h-8 elsa-w-8"},s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})))}renderWorkflowHelpButton(){return s("span",null,s("button",{type:"button",onClick:this.showHelpModal,class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-28 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"elsa-h-8 elsa-w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}))),s("elsa-modal-dialog",{ref:e=>this.helpDialog=e},!u.useX6Graphs&&s("div",{slot:"content",class:"elsa-p-8"},s("h3",{class:"elsa-text-lg elsa-font-medium"},"Actions"),s("dl",{class:"elsa-mt-2 elsa-border-t elsa-border-b elsa-border-gray-200 elsa-divide-y elsa-divide-gray-200"},s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Delete connections"),s("dd",{class:"elsa-text-gray-900"},"RIGHT-click the connection to delete.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Connect outcomes to existing activity"),s("dd",{class:"elsa-text-gray-900"},"Press and hold SHIFT while LEFT-clicking the outcome to connect. Release SHIFT and LEFT-click the target activity.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Pan"),s("dd",{class:"elsa-text-gray-900"},"Click anywhere on the designer and drag mouse.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Zoom"),s("dd",{class:"elsa-text-gray-900"},"Use scroll-wheel on mouse.")))),u.useX6Graphs&&s("div",{slot:"content",class:"elsa-p-8"},s("h3",{class:"elsa-text-lg elsa-font-medium"},"Actions"),s("dl",{class:"elsa-mt-2 elsa-border-t elsa-border-b elsa-border-gray-200 elsa-divide-y elsa-divide-gray-200"},s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Delete connections"),s("dd",{class:"elsa-text-gray-900"},"Hover on the connection and click the red X.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Edit activities"),s("dd",{class:"elsa-text-gray-900"},"Right click on the activity node and click Edit.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Pan"),s("dd",{class:"elsa-text-gray-900"},"Hold Ctrl, click anywhere on the designer and drag mouse.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Zoom"),s("dd",{class:"elsa-text-gray-900"},"Use scroll-wheel on mouse while holding Ctrl."))))))}renderSavingIndicator(){if(this.publishing)return;const e=this.t,t=this.unPublishing?e("Unpublishing..."):this.unPublished?e("Unpublished"):this.saving?"Saving...":this.saved?"Saved":this.importing?"Importing...":this.imported?"Imported":null;return t?s("div",null,s("span",{class:"elsa-text-gray-400 elsa-text-sm"},t)):void 0}renderNetworkError(){if(this.networkError)return s("div",null,s("span",{class:"elsa-text-rose-400 elsa-text-sm"},"An error occurred: ",this.networkError))}renderPublishButton(){return s("elsa-workflow-publish-button",{publishing:this.publishing,workflowDefinition:this.workflowDefinition,onPublishClicked:()=>this.onPublishClicked(),onUnPublishClicked:()=>this.onUnPublishClicked(),onRevertClicked:()=>this.onRevertClicked(),onExportClicked:()=>this.onExportClicked(),onImportClicked:e=>this.onImportClicked(e.detail),onDeleteClicked:()=>this.onDeleteClicked(),culture:this.culture})}static createWorkflowDefinition(){return{definitionId:null,version:1,isLatest:!0,isPublished:!1,activities:[],connections:[],persistenceBehavior:n.WorkflowBurst}}renderWorkflowPanel(){const e=this.workflowDefinition;return s("elsa-flyout-panel",{expandButtonPosition:3},s("elsa-tab-header",{tab:"general",slot:"header"},"General"),s("elsa-tab-content",{tab:"general",slot:"content"},s("elsa-workflow-properties-panel",{workflowDefinition:e})),this.renderTestPanel(),this.renderDesignerPanel(),this.renderVersionHistoryPanel(e))}renderTestPanel(){if(this.serverFeatures.find((e=>"WorkflowTesting"==e)))return[s("elsa-tab-header",{tab:"test",slot:"header"},"Test"),s("elsa-tab-content",{tab:"test",slot:"content"},s("elsa-workflow-test-panel",{workflowDefinition:this.workflowDefinition,workflowTestActivityId:this.selectedActivityId,selectedActivityId:this.selectedActivityId}))]}static get watchers(){return{workflowDefinitionId:["workflowDefinitionIdChangedHandler"],serverUrl:["serverUrlChangedHandler"],monacoLibPath:["monacoLibPathChangedHandler"]}}};a(x),w.injectProps(x,["serverUrl","culture","monacoLibPath","basePath","serverFeatures"]),x.style=".svg-loader{height:2rem;vertical-align:top}";export{x as elsa_workflow_definition_editor_screen};