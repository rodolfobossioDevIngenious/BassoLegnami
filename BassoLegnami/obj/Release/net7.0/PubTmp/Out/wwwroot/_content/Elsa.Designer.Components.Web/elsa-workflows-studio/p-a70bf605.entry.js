import{r as e,h as s}from"./p-ee0b9025.js";import{c as a}from"./p-a3b5bd35.js";import{e as t}from"./p-93cac3a6.js";import"./p-c74b54ba.js";import{E as l}from"./p-d88cb309.js";import{a as i}from"./p-ccd51ea4.js";import{c as r}from"./p-971980b1.js";import"./p-82db2ff5.js";import"./p-949334ec.js";import{i as o}from"./p-273970f1.js";import{T as n}from"./p-821a7518.js";import{D as h}from"./p-3478a766.js";import"./p-80de33dc.js";import"./p-e0c1fede.js";import"./p-f1ec68ec.js";import"./p-1b1f9628.js";import"./p-83f217d4.js";let d=class{constructor(s){e(this,s),this.currentProviderName="ProgrammaticWorkflowProvider",this.workflowProviders=[],this.workflowBlueprints={items:[],page:1,pageSize:50,totalCount:0},this.currentPage=0,this.currentPageSize=d.DEFAULT_PAGE_SIZE,this.workflowRegistryColumns={data:null},this.onPaged=async e=>{this.currentPage=e.detail.page,await this.loadWorkflowBlueprints()}}async componentWillLoad(){await this.loadWorkflowProviders(),this.history&&this.applyQueryString(this.history.location.search),await this.loadWorkflowBlueprints(),await t.emit(l.WorkflowRegistryLoadingColumns,this,this.workflowRegistryColumns)}connectedCallback(){this.history&&(this.unlistenRouteChanged=this.history.listen((e=>this.routeChanged(e)))),t.on(l.WorkflowUpdated,this.onLoadWorkflowBlueprints),t.on(l.WorkflowRegistryUpdated,this.onLoadWorkflowBlueprints)}disconnectedCallback(){this.unlistenRouteChanged&&this.unlistenRouteChanged(),t.detach(l.WorkflowUpdated,this.onLoadWorkflowBlueprints),t.detach(l.WorkflowRegistryUpdated,this.onLoadWorkflowBlueprints)}applyQueryString(e){const s=r(e);s.provider&&(this.currentProviderName=s.provider),this.currentPage=s.page?parseInt(s.page):0,this.currentPage=isNaN(this.currentPage)?d.START_PAGE:this.currentPage,this.currentPageSize=s.pageSize?parseInt(s.pageSize):d.DEFAULT_PAGE_SIZE,this.currentPageSize=isNaN(this.currentPageSize)?d.DEFAULT_PAGE_SIZE:this.currentPageSize,this.currentPageSize=Math.max(Math.min(this.currentPageSize,d.MAX_PAGE_SIZE),d.MIN_PAGE_SIZE)}async routeChanged(e){e.pathname.toLowerCase().endsWith("workflow-registry")&&(this.applyQueryString(e.search),await this.loadWorkflowBlueprints())}async onDisableWorkflowClick(e,s){await this.confirmDialog.show("Disable Workflow","Are you sure you wish to disable this workflow?")&&await this.updateFeature(s,"disabled","true")}async onEnableWorkflowClick(e,s){await this.confirmDialog.show("Enable Workflow","Are you sure you wish to enable this workflow?")&&await this.updateFeature(s,"disabled","false")}async updateFeature(e,s,a){const r={params:[e,s,a]};await t.emit(l.WorkflowRegistryUpdating,this,r)}async onLoadWorkflowBlueprints(){await this.loadWorkflowBlueprints()}async onWorkflowProviderChanged(e){this.currentProviderName=e,this.currentPage=0,await this.loadWorkflowBlueprints()}async loadWorkflowProviders(){const e=await this.createClient();this.workflowProviders=await e.workflowProvidersApi.list(),this.currentProviderName=this.workflowProviders.length>0?this.workflowProviders[0].name:void 0}async loadWorkflowBlueprints(){const e=await this.createClient(),s=this.currentPage,t=this.currentPageSize,a=this.currentProviderName;this.workflowBlueprints=await e.workflowRegistryApi.list(a,s,t,{isLatest:!0})}createClient(){return i(this.serverUrl)}render(){const e=this.workflowBlueprints.totalCount,t=a.groupBy(this.workflowBlueprints.items,"id"),l=this.basePath;let r=null!=this.workflowRegistryColumns.data?this.workflowRegistryColumns.data.headers:[],i=null!=this.workflowRegistryColumns.data&&this.workflowRegistryColumns.data.hasContextItems;const o=(e,t,a,l,r,o,n)=>{let d=[];return d=[...d,{text:"Edit",anchorUrl:l,icon:r}],i&&(d=t?[...d,{text:"Enable",clickHandler:s=>this.onEnableWorkflowClick(s,e),icon:o}]:[...d,{text:"Disable",clickHandler:s=>this.onDisableWorkflowClick(s,e),icon:n}]),s("td",{class:"elsa-pr-6"},s("elsa-context-menu",{history:a,menuItems:d}))};return s("div",null,s("div",{class:"elsa-p-8 elsa-flex elsa-content-end elsa-justify-right elsa-bg-white elsa-space-x-4"},s("div",{class:"elsa-flex-shrink-0"},this.renderWorkflowProviderFilter())),s("div",{class:"elsa-align-middle elsa-inline-block elsa-min-w-full elsa-border-b elsa-border-gray-200"},s("table",{class:"elsa-min-w-full"},s("thead",null,s("tr",{class:"elsa-border-t elsa-border-gray-200"},s("th",{class:"elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-left elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-left elsa-uppercase elsa-tracking-wider"},s("span",{class:"lg:elsa-pl-2"},"Name")),s("th",{class:"elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-left elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-left elsa-uppercase elsa-tracking-wider"},"Instances"),s("th",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-uppercase elsa-tracking-wider"},"Latest Version"),s("th",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-uppercase elsa-tracking-wider"},"Published Version"),r.map((e=>(e=>s("th",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-uppercase elsa-tracking-wider"},e[0]))(e))),s("th",{class:"elsa-pr-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-text-left elsa-uppercase elsa-tracking-wider"}))),s("tbody",{class:"elsa-bg-white elsa-divide-y elsa-divide-gray-100"},a.map(t,(e=>{const t=a.orderBy(e,"version","desc"),i=t[0],n=i.version,d=t.find((e=>e.isPublished)),h=d?d.version:"-";let c=i.displayName;c&&0!=c.trim().length||(c=i.name),c&&0!=c.trim().length||(c="(Untitled)");const p=`${l}/workflow-registry/${i.id}`,g=`${l}/workflow-instances?workflow=${i.id}`,w=s("svg",{class:"elsa-h-5 elsa-w-5 elsa-text-gray-500",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),u=s("svg",{class:"elsa-h-5 elsa-w-5 elsa-text-gray-500",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("path",{d:"M5 12l5 5l10 -10"})),m=s("svg",{class:"elsa-h-5 elsa-w-5 elsa-text-gray-500",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("circle",{cx:"12",cy:"12",r:"9"}),s("line",{x1:"5.7",y1:"5.7",x2:"18.3",y2:"18.3"}));return s("tr",null,s("td",{class:"elsa-px-6 elsa-py-3 elsa-whitespace-no-wrap elsa-text-sm elsa-leading-5 elsa-font-medium elsa-text-gray-900"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-3 lg:elsa-pl-2"},s("stencil-route-link",{url:p,anchorClass:"elsa-truncate hover:elsa-text-gray-600"},s("span",null,c)))),s("td",{class:"elsa-px-6 elsa-py-3 elsa-text-sm elsa-leading-5 elsa-text-gray-500 elsa-font-medium"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-3 lg:elsa-pl-2"},s("stencil-route-link",{url:g,anchorClass:"elsa-truncate hover:elsa-text-gray-600"},"Instances"))),s("td",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-whitespace-no-wrap elsa-text-sm elsa-leading-5 elsa-text-gray-500 elsa-text-right"},n),s("td",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-whitespace-no-wrap elsa-text-sm elsa-leading-5 elsa-text-gray-500 elsa-text-right"},h),r.map((()=>s("td",{class:"hidden md:elsa-table-cell elsa-px-6 elsa-py-3 elsa-whitespace-no-wrap elsa-text-sm elsa-leading-5 elsa-text-gray-500 elsa-text-right"},i.isDisabled?"No":"Yes"))),o(i.id,i.isDisabled,this.history,p,w,u,m))})))),s("elsa-pager",{page:this.currentPage,pageSize:this.currentPageSize,totalCount:e,history:this.history,onPaged:this.onPaged,culture:this.culture})),s("elsa-confirm-dialog",{ref:e=>this.confirmDialog=e}))}renderWorkflowProviderFilter(){const e=this.workflowProviders.map((e=>({text:e.displayName,value:e.name}))),t=this.workflowProviders.find((e=>e.name==this.currentProviderName));return s("elsa-dropdown-button",{text:(null==t?void 0:t.displayName)||"",items:e,icon:s("svg",{class:"elsa-mr-3 elsa-h-5 elsa-w-5 elsa-text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("rect",{x:"4",y:"4",width:"6",height:"6",rx:"1"}),s("rect",{x:"14",y:"4",width:"6",height:"6",rx:"1"}),s("rect",{x:"4",y:"14",width:"6",height:"6",rx:"1"}),s("rect",{x:"14",y:"14",width:"6",height:"6",rx:"1"})),origin:h.TopRight,onItemSelected:e=>this.onWorkflowProviderChanged(e.detail.value)})}};d.DEFAULT_PAGE_SIZE=5,d.MIN_PAGE_SIZE=5,d.MAX_PAGE_SIZE=100,d.START_PAGE=0,n.injectProps(d,["serverUrl","culture","basePath"]),o(d);export{d as elsa_workflow_registry_list_screen};